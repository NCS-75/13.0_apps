<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <template id="assets_frontend" inherit_id="website.assets_frontend" name="Website Quote frontend assets">
        <xpath expr="." position="inside">
            <script type="text/javascript" src="/website_purchase_quote/static/src/js/website_purchase_quotation.js" />
            <link rel="stylesheet" href="/website_purchase_quote/static/src/scss/website_quotation_1.scss" />
        </xpath>
    </template>

    <template id="assets_editor" inherit_id="website.assets_editor" name="Website Purchase Quote Editor assets">
        <xpath expr="." position="inside">
            <link rel="stylesheet" href="/website_purchase_quote/static/src/scss/website_quotation.scss" />
        </xpath>
    </template>

    <!-- Complete page of the quotation -->
    <template id="purchase_quotation" name="Product Quotation">
        <t t-call="portal.portal_layout">
            <t t-set="purchase_order" t-value="quotation" />
            <body data-spy="scroll" data-target=".navspy1" data-offset="50">
                <div class="container o_website_quote">
                    <div class="row mt16">
                        <div class="col-3 d-print-none">
                            <div class="bs-sidebar">
                                <div class="text-center" t-if="quotation.state in ('draft', 'sent', 'waiting_date')" style="padding: 10px">
                                    <a t-if="order_valid and not quotation.require_payment" class="btn btn-primary btn-block" data-toggle="modal" data-target="#modalaccept">
                                        <i class="fa fa-check" />
                                        Accept Order
                                    </a>
                                    <a t-if="order_valid and quotation.require_payment" href="#" class="btn btn-primary btn-block" data-toggle="modal" data-target="#modalaccept" role="button">
                                        <i class="fa fa-check" />
                                        Accept<!--  &amp; Pay -->
                                    </a>
                                    <a t-if="not order_valid" href="#discussion" class="btn btn-info btn-block o_normalwhitespace">
                                        <strong>This offer expired!</strong>
                                        <br />
                                        Contact us for new quote.
                                    </a>
                                    <div class="mt8" t-if="order_valid">
                                        <a data-toggle="modal" data-target="#modaldecline">Reject</a>
                                    </div>
                                </div>
                                <!-- <div class="text-center" t-if="need_payment or (quotation.state in ('purchase') and quotation.require_payment and tx_state != 'done')" style="padding: 10px">
                                    <a class="btn btn-primary btn-block" data-toggle="modal" data-target="#modalaccept">
                                        <i class="fa fa-check" />
                                        Pay Now
                                    </a>
                                </div> -->
                                <hr class="mt0 mb0" />
                                <t t-call="website_purchase_quote.navigation_website_purchase_quote" />
                                <hr class="mt0 mb0" />
                                <div t-if="order_valid and quotation.state in ['draft', 'sent']" class="text-center">
                                    <input type="hidden" t-att-value="quotation.validity_date" id="validity_date" />
                                    <div class="mt8" t-if="days_valid &gt; 0">
                                        <strong>This offer expires in</strong>
                                        <div class="day_counter mt8 mb16">
                                            <i class="fa fa-clock-o" />
                                            <t t-esc="days_valid" />
                                            <t t-if="days_valid &gt; 1">days</t>
                                            <t t-if="days_valid &lt;= 1">day</t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- Page content -->
                        <div id="quote_content" class="col-md-9">
                            <div class="alert alert-success alert-dismissable" t-if="message==1">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                Your message has been successfully sent!
                            </div>
                            <div class="alert alert-warning alert-dismissable" t-if="message==2">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                This quotation has been rejected.
                                <a href="#discussion">Contact us</a>
                                if you want a new one.
                            </div>
                            <div class="alert alert-warning alert-dismissable" t-if="message==3">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                This order has been validated. Thanks for your trust
                          and do not hesitate to
                                <a href="#discussion">contact us</a>
                                for
                          any question.
                            </div>
                            <!-- <t t-if="payment_tx">
                                <t t-set="payment_tx_id" t-value="payment_tx" />
                                <t t-call="website_purchase_quote.payment_confirmation_status_purchase" />
                            </t> -->
                            <div class="alert alert-warning alert-dismissable" t-if="message==4 and quotation.state != 'sent'">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                This order
                                <t t-if="quotation.state=='draft'">has not yet been sent!</t>
                                <t t-if="quotation.state=='cancel'">has already been cancelled!</t>
                                <t t-if="quotation.state not in ('cancel','draft')">has already been validated!</t>
                                You can
                                <a href="#discussion">contact us</a>
                                for
                          any questions.
                            </div>
                            <!-- modal relative to the actions Accept/Reject/Cancel -->
                            <div class="modal fade" id="modalaccept" role="dialog" aria-hidden="true">
                                <div class="modal-dialog">
                                    <form id="accept" method="POST" t-att-data-order-id="quotation.id" t-att-data-token="quotation.access_token" class="js_accept_json modal-content js_website_submit_form">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        <div class="modal-header">
                                            <h4 class="modal-title">Validate Order</h4>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                                        </div>
                                        <main class="modal-body" id="sign-dialog">
                                            <p>
                                                <span>By signing this proposal, I agree to the following terms:</span>
                                                <ul>
                                                    <li><span>Accepted on the behalf of:</span> <b t-field="quotation.partner_id.commercial_partner_id"/></li>
                                                    <li><span>For an amount of:</span> <b data-id="total_amount" t-field="quotation.amount_total"/></li>
                                                    <li t-if="quotation.payment_term_id"><span>With payment terms:</span> <b t-field="quotation.payment_term_id.note"/></li>
                                                </ul>
                                            </p>
                                            <t t-call="portal.signature_form">
                                                <t t-set="call_url" t-value="'/my/purchase/%s/accept' % (quotation.id)"/>
                                                <t t-set="default_name" t-value="quotation.partner_id.name"/>
                                            </t>
                                        </main>
                                    </form>
                                </div>
                            </div>
                            <div role="dialog" class="modal fade" id="modaldecline">
                                <div class="modal-dialog">
                                    <form id="decline" method="POST" t-attf-action="/purchase/#{quotation.id}/#{quotation.access_token}/decline" class="modal-content">
                                        <input type="hidden" name="csrf_token" t-att-value="request.csrf_token()"/>
                                        <header class="modal-header">
                                            <h4 class="modal-title">Reject This Quotation</h4>
                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">&amp;times;</button>
                                        </header>
                                        <main class="modal-body">
                                            <p>
                                                Tell us why you are refusing this quotation, this will help us improve our services.
                                            </p>
                                            <textarea rows="4" name="decline_message" required="" placeholder="Your feedback..." class="form-control" />
                                        </main>
                                        <footer class="modal-footer">
                                            <button type="submit" t-att-id="quotation.id" class="btn btn-danger"><i class="fa fa-times"></i> Reject</button>
                                            <button type="button" class="btn btn-primary" data-dismiss="modal">Cancel</button>
                                        </footer>
                                    </form>
                                </div>
                            </div>
                            <div class="alert alert-warning alert-dismissable d-print-none" t-if="quotation.state == 'cancel'">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                <strong>This quotation has been canceled.</strong>
                                Contact us to get a new quote.
                            </div>
                            <t t-call="website_purchase_quote.po_quotation_content_purchase" />
                            <div class="text-center d-print-none mt16 mb16" id="quotation_toolbar" t-if="quotation.state in ('draft', 'sent', 'waiting_date')">
                                <a class="btn btn-success" data-toggle="modal" data-target="#modalaccept" t-if="order_valid and not quotation.require_payment">
                                    <i class="fa fa-check" />
                                    Accept
                                </a>
                                <a class="btn btn-success" data-toggle="modal" data-target="#modalaccept" t-if="order_valid and quotation.require_payment">
                                    <i class="fa fa-check" />
                                    Accept <!-- &amp; Pay -->
                                </a>
                                <a class="btn btn-danger" data-toggle="modal" data-target="#modaldecline">
                                    <i class="fa fa-times" />
                                    Reject
                                </a>
                            </div>
                            <!-- <div class="text-center" t-if="need_payment or (quotation.state in ('purchase') and quotation.require_payment and tx_state != 'done')" style="padding: 10px">
                                <a class="btn btn-primary" data-toggle="modal" data-target="#modalaccept">
                                    <i class="fa fa-check" />
                                    Pay Now
                                </a>
                            </div> -->
                        </div>
                    </div>
                </div>
            </body>
        </t>
    </template>

    <template id="chatter_purchase" name="Allow Comments &amp; History" customize_show="True" inherit_id="website_purchase_quote.purchase_quotation">
        <xpath expr="//div[@id='quote_content']" position="inside">
            <h1 class="card-header">History</h1>
            <!-- Options:Quotation Chatter: user can reply -->
            <t t-call="portal.message_thread">
                <t t-set="object" t-value="quotation" />
            </t>
        </xpath>
        <xpath expr="//a[@data-target='#modaldecline']" position="before">
            <a type="submit" href="#discussion">Ask Changes</a>
        </xpath>
        <xpath expr="//div[@id='quotation_toolbar']/a[@data-target='#modaldecline']" position="before">
            <a class="btn btn-info" type="submit" href="#discussion">
                <i class="fa fa-comment" />
                Feedback
            </a>
        </xpath>
    </template>

    <template id="navigation_website_purchase_quote">
        <div class="navspy1" t-ignore="true" role="complementary">
            <ul class="nav bs-sidenav" data-id="purchase_sidebar">
                <li>
                    <a href="#introduction">Introduction</a>
                </li>
            </ul>
        </div>
    </template>

    <!-- Template to edit the quotation template with the website editor -->
    <template id="purchase_quotation_template" name="Purchase Template">
        <t t-call="website.layout">
            <body data-spy="scroll" data-target=".navspy1" data-offset="50">
                <div class="container o_website_quote">
                    <div class="row mt16">
                        <div class="col-md-3 d-print-none">
                            <div class="bs-sidebar">
                                <div class="navspy1" role="complementary" t-ignore="True">
                                    <ul class="nav bs-sidenav" data-id="purchase_sidebar" />
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="row">
                                <div t-ignore="true" class="css_editable_mode_hidden col-md-offset-11 pb16">
                                    <a class="btn btn-info d-print-none" t-att-href="'/web#return_label=Website&amp;model=%s&amp;id=%s&amp;action=%s&amp;view_type=form' % (template._name, template.id, request.env.ref('website_purchase_quote.action_purchase_quotation_template').id)">Back</a>
                                </div>
                            </div>
                            <div class="alert alert-info alert-dismissable" t-ignore="True">
                                <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                <p>
                                    <strong>Template Header:</strong>
                                    this content
                                will appear on all quotations using this
                                template.
                                </p>
                                <p class="text-muted">
                                    Titles with style
                                    <i>Heading 1</i>
                                    and
                                    <i>Heading 2</i>
                                    will be used to generate the
                                table of content automatically.
                                </p>
                            </div>
                            <div id="template_introduction" t-field="template.website_description" class="oe_no_empty" />
                            <t t-foreach="template.quote_line" t-as="line">
                                <div class="alert alert-info alert-dismissable" t-ignore="True">
                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                    Product:
                                    <strong t-esc="line.product_id.name" />
                                    :
                                this content will appear on the quotation only if this
                                product is put on the quote.
                                </div>
                                <div t-field="line.website_description" class="oe_no_empty" />
                            </t>
                            <t t-foreach="template.options" t-as="option_line">
                                <div class="alert alert-info alert-dismissable" t-ignore="True">
                                    <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&amp;times;</button>
                                    Optional Product:
                                    <strong t-esc="option_line.product_id.name" />
                                    :
                                this content will appear on the quotation only if this
                                product is used in the quote.
                                </div>
                                <div t-field="option_line.website_description" class="oe_no_empty" />
                            </t>
                            <section id="terms" class="container" t-if="template.note">
                                <h1 t-ignore="True">Terms &amp; Conditions</h1>
                                <p t-field="template.note" />
                            </section>
                        </div>
                    </div>
                </div>
            </body>
        </t>
    </template>

    <!-- <template id="website.layout_footer_copyright" inherit_id="website.layout" name="Footer Copyright"> -->
    <!-- <template id="website.footer_custom" inherit_id="website.layout" name="Footer">

        <xpath expr="//footer" position="inside">
            <section class="s_text_block pt16 pb8">
                <div class="container">
                    <div class="pull-right" t-ignore="true" t-if="not editable">
                        Powered by
                        <a target="_blank" class="label label-danger" href="http://www.odoo.com/page/website-builder">Odoo</a>
                        ,
                      an awesome
                        <a target="_blank" href="http://www.odoo.com/page/crm">Open Source CRM</a>
                        .
                    </div>
                    <div class="pull-left text-muted">
                        Copyright &amp;copy;
                        <span t-field="res_company.name">Company name</span>
                    </div>
                </div>
            </section>
        </xpath>
    </template> -->

    <!-- <template id="portal_purchase_quotations" name="My Quotations">
        <t t-call="portal.portal_layout">
            <h3>
                Purchase Quotations
                <t t-call="portal.portal_searchbar" />
            </h3>
            <t t-if="not quotations">
                <p>There are currently no quotations for your account.</p>
            </t>
            <div t-if="quotations" class="panel panel-default">
                <div class="table-responsive">
                    <table class="table table-hover o_portal_my_doc_table">
                        <thead>
                            <tr class="active">
                                <th>Quotation #</th>
                                <th>Order Date</th>
                                <th>Valid Until</th>
                                <th />
                                <th>Total</th>
                            </tr>
                        </thead>
                        <t t-foreach="quotations" t-as="quotation">
                            <tr>
                                <td>
                                    <a t-attf-href="/my/orders/#{quotation.id}?#{keep_query()}">
                                        <t t-esc="quotation.name" />
                                    </a>
                                </td>
                                <td>
                                    <span t-field="quotation.date_order" />
                                </td>
                                <td>
                                    <span t-field="quotation.validity_date" />
                                </td>
                                <td>
                                    <t t-if="quotation.state == 'cancel'">
                                        <span class="label label-default">
                                            <i class="fa fa-fw fa-remove" />
                                            Cancelled
                                        </span>
                                    </t>
                                    <t t-if="quotation.is_expired">
                                        <span class="label label-default">
                                            <i class="fa fa-fw fa-clock-o" />
                                            Expired
                                        </span>
                                    </t>
                                </td>
                                <td>
                                    <span t-field="quotation.amount_total" t-options="{&quot;widget&quot;: &quot;monetary&quot;, &quot;display_currency&quot;: quotation.pricelist_id.currency_id}" />
                                </td>
                            </tr>
                        </t>
                    </table>
                </div>
                <div t-if="pager" class="o_portal_pager text-center">
                    <t t-call="portal.pager" />
                </div>
            </div>
        </t>
    </template> -->

    <!-- <template id="purchase_portal_my_quotations_inherit_quote" inherit_id="website_purchase_quote.portal_purchase_quotations">
        <xpath expr="//t[@t-foreach='quotations']/tr/td/a" position="replace">
            <t t-if="quotation.po_template_id and quotation.po_template_id.active">
                <a t-attf-href="/purchase/#{quotation.id}?#{keep_query()}">
                    <t t-esc="quotation.name" />
                </a>
            </t>
            <t t-else="">
                <a t-attf-href="/my/purchase_orders/#{quotation.id}?#{keep_query()}">
                    <t t-esc="quotation.name" />
                </a>
            </t>
        </xpath>
    </template> -->

</odoo>
